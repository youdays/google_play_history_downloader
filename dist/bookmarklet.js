javascript:(()=>{const t="https://play.google.com/store/account/orderhistory",a=()=>{return t=3,new Promise(e=>{setTimeout(()=>{e()},1e3*t)});var t},n=()=>{var e=document.documentElement,e=e.scrollHeight-e.clientHeight;window.scroll(0,e)},l=()=>document.documentElement.scrollHeight,r=()=>document.getElementsByClassName("NVOyre")[0].querySelector('[role="button"]'),s=()=>document.getElementsByClassName("U6fuTe"),c=e=>{return{img:e.getElementsByClassName("T75of")[0].getAttribute("src"),date:e.getElementsByClassName("goeMJb")[0].textContent,detail:e.getElementsByClassName("XqqpEd")[0].textContent,price:e.getElementsByClassName("mshXob")[0].textContent.replace(/[^0-9]/g,"")}},o=e=>'"'+e.replaceAll('"','""')+'"';(async()=>{if(!location.href.startsWith(t))return alert(`「注文履歴 - Google Play」( ${t} )で実行してください。`);confirm("CSVファイルを作る前にすべての履歴を読み込みますか?")&&(alert("すべての履歴を読み込みます。しばらく画面が動きますが、CSV完成までそのままお待ち下さい。"),await(async()=>{let e=l();for(;;){n(),await a();const o=r();o&&(o.click(),await a());var t=l();if(t===e)break;e=t}})());var e="date, price, img, detail\n"+(()=>{const t=[];var o=s();for(let e=0;e<o.length;e++){var a=o[e];t.push(c(a))}return t})().map(e=>[e.date,e.price,e.img,e.detail].map(o).join(",")).join("\n");(e=>{var t=`google_play_history_${(new Date).getTime()}.csv`,o=new Uint8Array([239,187,191]),e=new Blob([o,e],{type:"text/csv"});const a=document.createElement("a");e=URL.createObjectURL(e);a.href=e,a.download=t,a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(e)})(e)})()})();
